# Лабораторная работа 4

**Тема:** Многопоточность и синхронизация потоков

**Цель работы:** Изучить проблему синхронизации потоков, научиться выявлять и предотвращать взаимоблокировки (deadlock).

## Реализованные задачи

### 1. Обедающие философы (Dining Philosophers)
- **Цель:** Избежать deadlock и starvation
- **Реализовано:**
  - Версия **с deadlock** (демонстрация проблемы)
  - Версия **без deadlock** (исправление через порядок взятия вилок)
- **Используется:** `lock`, многопоточность

### 2. Задача о спящем парикмахере (Sleeping Barber)
- **Цель:** Смоделировать поведение парикмахерской через многопоточность
- **Особенности:** Ограниченное количество мест ожидания
- **Используется:** `SemaphoreSlim`, `CancellationToken`

### 3. Производитель-Потребитель (Producer-Consumer)
- **Цель:** Обеспечить правильную синхронизацию доступа к общему буферу
- **Реализовано:**
  - Решение с использованием `BlockingCollection` (готовое)
  - Решение с использованием `SemaphoreSlim` + `lock` (самописное)
- **Буфер:** Ограниченная очередь

## Ключевые понятия

### 1. Race Condition (Состояние гонки)
- Возникает, когда несколько потоков обращаются к общим данным без синхронизации
- **Пример из задачи:** Несинхронизированный доступ к счетчику в тестах

### 2. Deadlock (Взаимная блокировка)
- Ситуация, когда два или более потока ждут ресурсы, занятые друг другом
- **Пример:** В первой версии "Обедающих философов"

### 3. Starvation (Голодание)
- Ситуация, когда поток долго не может получить доступ к ресурсу
- **Предотвращение:** Честные алгоритмы планирования

## Синхронизирующие примитивы

### `lock` (Monitor)
- Базовый механизм синхронизации
- Позволяет войти в критическую секцию только одному потоку
- **Использование:** в задачах "Обедающие философы" и "Производитель-Потребитель"

### `SemaphoreSlim`
- Ограничивает количество потоков, которые могут войти в критическую секцию
- **Использование:** в задачах "Спящий парикмахер" и "Производитель-Потребитель"

### `Mutex`
- Аналогичен `lock`, но может быть именованным и использоваться между процессами
- **Использование:** не использовался в данной работе (можно добавить)

### `BlockingCollection`
- Готовая потокобезопасная коллекция
- Автоматически блокирует производителей при переполнении и потребителей при опустошении
- **Использование:** в задаче "Производитель-Потребитель"

## Инструкция по запуску

```bash
cd lab04

# Запуск тестов (опционально)
dotnet test Lab04.Tests/Lab04.Tests.csproj

# Запуск основной программы
dotnet run --project Lab04/Lab04.csproj